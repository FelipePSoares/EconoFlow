<div class="container text-center">
  <div class="col text-center mt-3">
    <h2 class="mb-0">
      {{ userProject.project.name }}
    </h2>
  </div>
  <app-current-date (dateUpdatedEvent)="updateDate($event)"></app-current-date>
  <div class="row">
    <div class="d-flex justify-content-start">
      <div class="d-flex pe-3 mt-2 border-end">
        <div class="card min-width" (click)="selectIncomes()">
          <div class="card-body">
            <h3 class="card-title">{{ 'TotalIncome' | translate }}</h3>
            <div>
              <span class="card-value success">
                {{ month.earned | currencyFormat: true }}
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="slider-container flex-fill ms-3">
        <ul class="slider list-unstyled d-flex">
          @for (category of (categories$ | async); track category.id) {
            <li class="slide me-1">
              <div class="card" [class.archived]="category.isArchived" (click)="selectCategory(category.id)">
                <div class="card-fill"
                  [ngClass]="getBgClassBasedOnCategory(category)"
                [style.height]="setHeight ? category.getPercentageSpend() + 'px' : '0px'"></div>
                <div class="card-body">
                  <h3 class="card-title">{{ category.name }}</h3>

                  <div>
                    <span class="card-value danger d-block">
                      {{ (category.getTotalSpend() + category.getTotalOverspend()) | currencyFormat: true }}
                    </span>
                    @if(!category.hasBudget()){
                      <span class="card-small-text">{{ 'SetBudget' | translate }}</span>
                    } @else if (category.hasOverspend()){
                      <span class="card-small-text danger">
                        {{ 'BudgetExceeded' | translate }}
                      </span>
                    } @else {
                      <span class="card-small-text" [ngClass]="getClassBasedOnCategory(category)">
                        {{ category.getTotalRemaining() | currencyFormat: true }} {{ 'Remaining' | translate }}
                      </span>
                    }
                  </div>
                </div>
              </div>
            </li>
          }
          @if (canAddOrEdit()){
          <li class="slide">
            <div class="card btn-add min-width" (click)="listCategories()">
              <div class="card-body">
                <i class="bi bi-plus fs-4 btn btn-primary btn-circle"></i>
                <span class="mt-2">{{ 'AddAndEdit' | translate }}</span>
              </div>
            </div>
          </li>
          }
        </ul>
      </div>
    </div>
  </div>
  <div class="row justify-content-center">
    <div class="container text-center">
      <div class="row justify-content-center">
        <div class="col-lg-6">
          <div class="wrap p-3">
            <div class="container position-relative">
              <div class="row align-items-center">
                <!-- Centered title -->
                <div class="col text-center mt-3 mb-3 month">
                  <a class="overview-link" (click)="openMonthlyOverview()" role="button" title="{{ 'MonthlyOverview' | translate }}">
                    <h2 class="overview-heading">
                      {{ getCurrentDate() | date: 'MMMM' }}
                      <i class="bi bi-box-arrow-up-right overview-icon"></i>
                    </h2>
                  </a>
                </div>
              </div>
            </div>

            @if (showCopyPreviousButton) {
              <button class="btn btn-primary"
                (click)="copyPreviousBudget()"
                >
                {{ 'ButtonClonePreviousBudget' | translate }}
              </button>
            }
            <app-budget-bar
              [spend]="month.spend"
              [budget]="month.budget"
              [overspend]="month.overspend"
              [remaining]="month.remaining"
              [hideDecimals]="true"
              [typeMonthOrYear]="'month'">
            </app-budget-bar>
            <hr class="solid" />
            <div class="d-grid label-money">
              <div class="mt-2">
                <span class="float-start"><i class="bi bi-arrow-up-right money-out"></i> {{ 'MoneyOut' | translate }}</span>
                <span class="float-end danger">{{ month.spend + month.overspend | currencyFormat: true }}</span>
              </div>
              <div class="mt-2">
                <span class="float-start"><i class="bi bi-arrow-down-left money-in"></i> {{ 'MoneyIn' | translate }}</span>
                <span class="float-end success">{{ month.earned | currencyFormat: true }}</span>
              </div>
            </div>
            <hr class="solid" />
            <div class="mt-3">
              <h3 class="mt-0 mb-3 text-start fw-semibold fs-6">{{ 'Monthly Expenses Chart' | translate }}</h3>
              <app-monthly-expenses-chart [expenses]="currentMonthExpenses" [budget]="month.budget"></app-monthly-expenses-chart>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="wrap p-3">
            <div class="container position-relative">
              <div class="row align-items-center">
                <div class="col text-center mt-3 mb-3 month">
                  <a class="overview-link" (click)="openAnnualOverview()" role="button" title="{{ 'AnnualOverview' | translate }}">
                    <h2 class="overview-heading">
                      {{ getCurrentDate() | date: 'yyyy'}}
                      <i class="bi bi-box-arrow-up-right overview-icon"></i>
                    </h2>
                  </a>
                </div>
              </div>
            </div>
            <app-budget-bar [spend]="year.spend"
                            [budget]="year.budget"
                            [overspend]="year.overspend"
                            [remaining]="year.remaining"
                            [hideDecimals]="true"
                            [typeMonthOrYear]="'year'">
            </app-budget-bar>
            <hr class="solid" />
            <div class="d-grid label-money">
              <div class="mt-2">
                <span class="float-start"><i class="bi bi-arrow-up-right money-out"></i> {{ 'MoneyOut' | translate }}</span>
                <span class="float-end danger">{{ year.spend + year.overspend | currencyFormat: true }}</span>
              </div>
              <div class="mt-2">
                <span class="float-start"><i class="bi bi-arrow-down-left money-in"></i> {{ 'MoneyIn' | translate }}</span>
                <span class="float-end success">{{ year.earned | currencyFormat: true }}</span>
              </div>
            </div>
            <hr class="solid" />
            <div class="row g-3 mt-1">
              <div class="col-12 col-md-6">
                <h3 class="mt-0 mb-3 text-start fw-semibold fs-6">{{ 'IncomeVsExpenseByMonth' | translate }}</h3>
                @if (yearIncomeExpenseChartData.datasets[0].data.length || yearIncomeExpenseChartData.datasets[1].data.length) {
                  <div class="position-relative" style="height: 240px;">
                    <canvas
                      baseChart
                      [type]="'bar'"
                      [data]="yearIncomeExpenseChartData"
                      [options]="yearIncomeExpenseChartOptions">
                    </canvas>
                  </div>
                } @else {
                  <p class="text-center text-secondary mb-0">{{ 'NoDataForSelectedPeriod' | translate }}</p>
                }
              </div>
              <div class="col-12 col-md-6">
                <h3 class="mt-0 mb-3 text-start fw-semibold fs-6">{{ 'ExpensesByCategory' | translate }}</h3>
                @if (yearExpenseCategoryChartData.datasets[0].data.length) {
                  <div class="position-relative" style="height: 240px;">
                    <canvas
                      baseChart
                      [type]="'doughnut'"
                      [data]="yearExpenseCategoryChartData"
                      [options]="yearExpenseCategoryChartOptions">
                    </canvas>
                  </div>
                } @else {
                  <p class="text-center text-secondary mb-0">{{ 'NoDataForSelectedPeriod' | translate }}</p>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <div class="wrap">
            <div class="row align-items-center">
              <div class="col text-center mt-3 mb-3 month">
                <h2>{{ 'LatestTransactions' | translate }}</h2>
              </div>
            </div>
            <div class="table-responsive">
              <table mat-table [dataSource]="(transactions$ | async) || []" class="w-100">
                <ng-container matColumnDef="date">
                  <th mat-header-cell *matHeaderCellDef class="ps-4"> {{ 'Date' | translate }} </th>
                  <td mat-cell *matCellDef="let row" class="ps-4">
                    <div class="text-secondary">{{row.date | date: 'dd/MM/yyyy' }}</div>
                  </td>
                </ng-container>

                <ng-container matColumnDef="description">
                  <th mat-header-cell *matHeaderCellDef> {{ 'Description' | translate }} </th>
                  <td mat-cell *matCellDef="let row">
                    <div class="d-flex align-items-center py-2 py-md-3">
                      <div class="transaction-icon me-2 me-md-3 flex-shrink-0">
                        <i class="bi" [class]="row.type === 'Income' ? 'bi-arrow-down-left money-in' : 'bi-arrow-up-right money-out'"></i>
                      </div>
                      <div class="min-w-0">
                        <div class="fw-medium text-truncate">{{ row.name }}</div>
                        <div class="badges-row">
                          <span class="badge-type" [class]="row.type === 'Income' ? 'badge-income' : 'badge-expense'">
                            {{ row.type | translate }}
                          </span>
                          @if (row.categoryName) {
                          <span class="badge-category">
                            <i class="bi bi-tag-fill"></i>
                            <span class="badge-label">{{ row.categoryName }}</span>
                          </span>
                          }
                          @if (row.parentExpenseName) {
                          <span class="badge-category">
                            <i class="bi bi-link-45deg"></i>
                            <span class="badge-label">{{ row.parentExpenseName }}</span>
                          </span>
                          }
                        </div>
                      </div>
                    </div>
                  </td>
                </ng-container>

                <ng-container matColumnDef="amount">
                  <th mat-header-cell *matHeaderCellDef class="pe-4 text-end"> {{ 'Amount' | translate }} </th>
                  <td mat-cell *matCellDef="let row" class="pe-4 text-end">
                    <div [class]="row.type === 'Income' ? 'text-success fw-medium' : 'text-danger fw-medium'">
                      {{ row.amount | currencyFormat }}
                    </div>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="['date', 'description', 'amount']" class="bg-light"></tr>
                <tr mat-row *matRowDef="let row; columns: ['date', 'description', 'amount'];"
                    class="hover-row"></tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
